<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سرویس من - امتیاز‌دهی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'gold': '#ffc107',
                    }
                }
            }
        }
    </script>
    <style>

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        @keyframes starPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .star-pop {
            animation: starPop 0.5s ease-in-out;
        }
        
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center py-8">
    <div class="container max-w-4xl mx-auto px-4">
        <!-- Service Card -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
            <div class="md:flex">
                <div class="md:w-2/5 p-6 bg-gradient-to-br from-amber-500 to-amber-700 flex items-center justify-center">
                    <div class="text-center text-white">
                        <i class="fas fa-cloud-service text-7xl mb-4"></i>
                        <h1 class="text-2xl font-bold">سرویس ابری پیشرفته</h1>
                        <p class="mt-2 opacity-90">فضای ابری امن برای استارتاپ‌ها</p>
                    </div>
                </div>
                <div class="md:w-3/5 p-6">
                    <div class="flex flex-col gap-2 mb-6">
                        <div class="flex items-center">
                            <i class="fas fa-database text-amber-600 text-xl ml-2"></i>
                            <span>100 گیگابایت فضای ذخیره‌سازی</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-user-shield text-amber-600 text-xl ml-2"></i>
                            <span>امنیت پیشرفته SSL</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-sync-alt text-amber-600 text-xl ml-2"></i>
                            <span>پشتیبانی 24/7</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-plug text-amber-600 text-xl ml-2"></i>
                            <span>یکپارچه‌سازی با برنامه‌ها</span>
                        </div>
                    </div>
                    <div class="border-t pt-4">
                        <p class="text-gray-600">
                            سرویس ابری پیشرفته با امکانات کامل برای کسب‌وکار‌های نوپا و سازمان‌های بزرگ. دسترسی امن و سریع به داده‌هایتان از هر کجای دنیا.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Rating Component -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-4 mb-6">امتیازدهی به سرویس</h2>
            
            <!-- Rating Stats -->
            <div id="rating-component" class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                <div id="average-section" class="flex items-center mb-4 md:mb-0">
                    <div class="bg-amber-100 text-amber-800 w-14 h-14 rounded-full flex items-center justify-center ml-3">
                        <i class="fas fa-star"></i>
                    </div>
                    <div>
                        <p class="text-gray-600">میانگین امتیاز سرویس:</p>
                        <div class="flex items-baseline">
                            <span id="avg_score" class="text-2xl font-bold text-amber-600">4.3</span>
                            <span class="text-gray-500 text-sm mr-1">از 5</span>
                        </div>
                    </div>
                </div>
                
                <!-- Rating Controls -->
                <div id="user-rating-section" class="flex-1 w-full md:w-auto">
                    <!-- User Rating Controls will be rendered here by JavaScript -->
                </div>
            </div>
            
            <!-- Rating Chart -->
            <div class="hidden md:block mt-10 mb-8">
                <h3 class="text-lg font-medium mb-4 text-gray-700">توزیع امتیازات</h3>
                <div class="space-y-3">
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 5</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-3/4"></div>
                        </div>
                        <span class="w-8 text-right">75%</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 4</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-1/2"></div>
                        </div>
                        <span class="w-8 text-right">50%</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 3</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-1/3"></div>
                        </div>
                        <span class="w-8 text-right">33%</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 2</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-1/5"></div>
                        </div>
                        <span class="w-8 text-right">20%</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 1</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-1/10"></div>
                        </div>
                        <span class="w-8 text-right">10%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notification Container -->
        <div id="notification" class="fixed top-5 left-1/2 transform -translate-x-1/2 w-full max-w-md px-4 z-50"></div>
    </div>
    
    <script>
        // Initialize service data
        const serviceId = 1;
        let selectedScore = 0;
        let userHasRated = false;
        
        // Initialize the rating component
        function initRatingComponent() {
            const ratingSection = document.getElementById('user-rating-section');
            const avgScoreSpan = document.getElementById('avg_score');
            
            // Check if user has rated this service in localStorage
            const storedRating = localStorage.getItem(`service_rating_${serviceId}`);
            if (storedRating) {
                const {score, rated} = JSON.parse(storedRating);
                if (rated) {
                    userHasRated = true;
                    selectedScore = score;
                    renderRatedState(score);
                    avgScoreSpan.textContent = (parseFloat(avgScoreSpan.textContent) + 0.2).toFixed(1);
                    return;
                }
            }
            
            // Render the rating UI for an unrated user
            renderInteractiveRating();
        }
        
        // Render the interactive rating UI
        function renderInteractiveRating() {
            const ratingSection = document.getElementById('user-rating-section');
            ratingSection.innerHTML = `
                <div class="bg-gray-50 rounded-xl p-5 shadow-sm">
                    <div id="star-rating-group" data-service-id="${serviceId}" class="flex justify-center my-4">
                        ${Array(5).fill().map((_, i) => 
                            `<span id="star_${5-i}" class="fa fa-star text-3xl mx-1 cursor-pointer text-gray-300 hover:text-amber-400 transition-colors duration-300" data-score="${5-i}" onclick="handleStarClick(${5-i})"></span>`
                        ).join('')}
                    </div>
                    
                    <div class="mt-5">
                        <label for="idea_text" class="block text-sm font-medium text-gray-700 mb-2">ایده یا نظر خود را با ما در میان بگذارید</label>
                        <textarea id="idea_text" rows="3" placeholder="نظر شما برای بهبود سرویس ما بسیار ارزشمند است..." class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-amber-300 focus:border-amber-400 transition"></textarea>
                    </div>
                    
                    <button id="submit_idea_btn" class="mt-4 w-full py-3 bg-gradient-to-r from-amber-500 to-amber-700 text-white font-bold rounded-lg shadow-md hover:from-amber-600 hover:to-amber-800 transition-all duration-300 transform hover:scale-[1.02]" onclick="submitIdea()">
                        ثبت امتیاز و نظر
                    </button>
                </div>
            `;
        }
        
        // Render UI for already rated users
        function renderRatedState(score) {
            const ratingSection = document.getElementById('user-rating-section');
            ratingSection.innerHTML = `
                <div class="bg-amber-50 rounded-xl p-5 border border-amber-200">
                    <div class="flex flex-col items-center">
                        <div class="flex my-2">
                            ${Array(5).fill().map((_, i) => 
                                `<span class="fa fa-star text-3xl mx-1 ${i < score ? 'text-amber-500' : 'text-gray-300'}"></span>`
                            ).join('')}
                        </div>
                        <div class="mt-2 bg-amber-100 text-amber-800 px-4 py-2 rounded-full text-sm">
                            <i class="fas fa-check-circle ml-1"></i>
                            امتیاز شما: ${score} ستاره
                        </div>
                        <p class="text-sm text-gray-600 mt-3 text-center">
                            از امتیازدهی و نظر شما سپاسگزاریم.
                        </p>
                    </div>
                </div>
            `;
        }
        
        // Handle star selection
        function handleStarClick(score) {
            if (userHasRated) return;
            
            selectedScore = score;
            const stars = document.querySelectorAll('#star-rating-group .fa-star');
            
            // Update star appearance
            stars.forEach(star => {
                const starScore = parseInt(star.getAttribute('data-score'));
                if (starScore <= score) {
                    star.classList.add('text-amber-500', 'star-pop');
                    star.classList.remove('text-gray-300');
                } else {
                    star.classList.add('text-gray-300');
                    star.classList.remove('text-amber-500');
                }
            });
        }
        
        // Submit rating and idea
        function submitIdea() {
            const ideaText = document.getElementById('idea_text').value;
            
            if (!selectedScore) {
                showNotification('لطفاً ابتدا امتیاز خود را انتخاب کنید', 'error');
                return;
            }
            
            // Save to localStorage
            localStorage.setItem(`service_rating_${serviceId}`, JSON.stringify({
                serviceId: serviceId,
                score: selectedScore,
                idea: ideaText,
                rated: true,
                timestamp: new Date().toISOString()
            }));
            
            userHasRated = true;
            renderRatedState(selectedScore);
            updateAverageScore();
            showNotification('امتیاز شما با موفقیت ثبت شد. از نظر شما سپاسگزاریم!', 'success');
        }
        
        // Update average score visually
        function updateAverageScore() {
            const avgScoreSpan = document.getElementById('avg_score');
            let currentScore = parseFloat(avgScoreSpan.textContent);
            avgScoreSpan.textContent = (currentScore + 0.1).toFixed(1);
        }
        
        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-rose-500';
            
            notification.innerHTML = `
                <div class="flex items-center ${bgColor} text-white text-sm font-bold px-4 py-3 rounded-md shadow-lg transform transition-transform duration-300 translate-y-0" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} mr-2 text-xl"></i>
                    <div>
                        <p class="font-bold">${type === 'success' ? 'موفقیت‌آمیز' : 'خطا'}</p>
                        <p>${message}</p>
                    </div>
                </div>
            `;
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                notification.innerHTML = '';
            }, 3000);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initRatingComponent);
    </script>
</body>
</html>