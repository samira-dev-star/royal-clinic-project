{% extends "main_template.html" %}

{% load static %}
{% load render_partial %}

{% block extra_css %}
<link rel="stylesheet" href="{% static "css/service_details.css" %}">
{% endblock extra_css %}

{% block title %}Ø¬Ø²Ø¦ÛŒØ§Øª Ø³Ø±ÙˆÛŒØ³{% endblock title %}





{% block content %}

{% if specific_service_clicked.has_discount %}
            <div class="fixed left-4 bottom-6 z-50 bg-gradient-to-r from-red-600 to-yellow-500 text-white px-6 py-6 rounded-xl shadow-lg flex items-center justify-between animate-pulse space-x-4">
                <p class="text-sm font-bold">ğŸ‰ ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡: </p>
                <a href="#offers" class="underline text-sm hover:text-yellow-100 transition duration-300">Ø§ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ Ø´Ø§Ù…Ù„ ØªØ®ÙÛŒÙ Ù…ÛŒ Ø¨Ø§Ø´Ø¯</a>
            </div>
{% endif %}



            
    <!-- Service Hero -->
    <section class="service-hero py-20 md:py-32 text-white" style="background-image: url('{{ media_url }}{{ specific_service_clicked.service_image }}'); background-size: cover; background-position: center;">
        <div class="container mx-auto px-4">
            
            <div class="max-w-3xl">
                
                <div class="flex items-center mb-4">
                    <span class="bg-amber-600 px-3 py-1 rounded-full text-sm font-medium">{{specific_service_clicked.service_title}}</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold mb-6">{{specific_service_clicked.service_title}}</h1>

                <p class="text-xl mb-8">
                    {% autoescape off %}
                    {{specific_service_clicked.service_short_description}}
                    {% endautoescape %}
                </p>

                <div class="flex space-x-4 space-x-reverse">
                    <a href="#appointment" class="bg-amber-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-amber-700 transition duration-300">Ø±Ø²Ø±Ùˆ Ù†ÙˆØ¨Øª</a>
                    <a href="#details" class="border border-white text-white px-6 py-3 rounded-lg font-bold hover:bg-white hover:text-gray-800 transition duration-300">Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ±</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Service Details -->
    <section id="details" class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <div class="flex flex-col lg:flex-row gap-12">
                <!-- Main Content -->
                <div class="lg:w-2/3">
                    <!-- Tabs -->
                    <div class="mb-8 border-b border-gray-200">
                        <div class="flex space-x-8 space-x-reverse">
                            <button class="tab-btn py-3 px-1 font-medium text-gray-700 hover:text-gray-800 border-b-2 border-transparent hover:border-amber-500" data-tab="overview">Ù…Ø¹Ø±ÙÛŒ Ø®Ø¯Ù…Øª</button>
                            <button class="tab-btn py-3 px-1 font-medium text-gray-700 hover:text-gray-800 border-b-2 border-transparent hover:border-amber-500" data-tab="procedure">Ø±ÙˆØ´ Ø§Ù†Ø¬Ø§Ù…</button>
                            <button class="tab-btn py-3 px-1 font-medium text-gray-700 hover:text-gray-800 border-b-2 border-transparent hover:border-amber-500" data-tab="faq">Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„</button>
                        </div>
                    </div>
                    



                    <!-- Tab Contents -->
                    <div class="tab-content active" id="overview">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">{{specific_service_clicked.service_title}}</h2>
                        <p class="text-black mb-6 leading-relaxed">
                            {% autoescape off %}
                            {{specific_service_clicked.service_short_description}}
                            {% endautoescape %}
                        </p>
                        <p class="text-black mb-6 leading-relaxed">
                            {% autoescape off %}
                            {{specific_service_clicked.service_description}}
                            {% endautoescape %}
                        </p>
                        
                        <h3 class="text-2xl font-bold text-gray-800 mt-10 mb-4">Ù…Ø²Ø§ÛŒØ§ÛŒ {{specific_service_clicked.service_title}}</h3>
                        {% render_partial "services:service_advantages" slug=specific_service_clicked.slug %}
                        
                        
                        <h3 class="text-2xl font-bold text-gray-800 mt-10 mb-4">Ú†Ù‡ Ø§ÙØ±Ø§Ø¯ÛŒ Ú©Ø§Ù†Ø¯ÛŒØ¯ Ù…Ù†Ø§Ø³Ø¨ÛŒ Ù‡Ø³ØªÙ†Ø¯ØŸ</h3>
                        
                        <p class="text-gray-800 mb-4 leading-relaxed">  
                            {% autoescape off %}
                                {{specific_service_clicked.proper_candidate_description}} 
                            {% endautoescape %}
                        </p>
                        {% render_partial "services:service_conditions" slug=specific_service_clicked.slug %}
                        
                        

                    </div>
                    
                    <div  id="procedure">
                        
                        {% if specific_service_clicked.procedure_description %}
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Ø±ÙˆØ´ {{specific_service_clicked.service_title}}</h2>
                        {% endif %}
                        <p class="text-gray-800 mb-8 leading-relaxed">

                            {% if specific_service_clicked.procedure_description %}
                            {% autoescape off %}
                            {{specific_service_clicked.procedure_description}}
                            {% endautoescape %}
                            {% else %}
                            
                            {% endif %}
                            
                        </p>
                        
                        <div class="space-y-8">
                            
                            {% render_partial "services:service_procedures" slug=specific_service_clicked.slug %}

                        </div>
                    </div>

                    
                    
                    <div  id="faq">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„ Ø¯Ø±Ø¨Ø§Ø±Ù‡ ÛŒ {{specific_service_clicked.service_title}}</h2>
                        
                        <div class="space-y-4">

                            {% render_partial "services:service_questions" slug=specific_service_clicked.slug %}

                        </div>
                    </div>


                    
                </div>
                
                <!-- Sidebar -->
                <div class="lg:w-1/3">
                    <div class="bg-gray-50 p-6 rounded-lg sticky top-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ø¯Ù…Øª</h3>

                        
                        {% render_partial "services:service_feature_values" slug=specific_service_clicked.slug %}
                        
                        <a href="#appointment" class="mt-8 w-full bg-amber-600 text-white py-3 px-6 rounded-lg font-bold hover:bg-amber-700 transition duration-300 flex items-center justify-center">
                            <span>Ø±Ø²Ø±Ùˆ Ù†ÙˆØ¨Øª</span>
                            <i class="fas fa-arrow-left mr-2"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

{% comment %} -------------------------------------------------------------------------------------------------------------------------- {% endcomment %}
    
    <div class="product-tabs__pane" id="tab-reviews">
        <div class="reviews-view">
            <div class="reviews-view__list">
                <h3 class="reviews-view__header">Ø¯ÛŒØ¯Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ùˆ Ø³ÙˆØ§Ù„Ø§Øª Ø²ÛŒØ¨Ø§ Ø¬ÙˆÛŒØ§Ù† Ø¯Ø±Ø¨Ø§Ø±Ù‡ ÛŒ {{specific_service_clicked.service_title}} </h3>
                <div class="reviews-list">
                    <ol class="reviews-list__content">

                        {% for comment in specific_service_clicked.service_comments.all %}
                            {% if comment.is_active and comment.comment_parent == None %}
						        <!-- Ú©Ø§Ù…Ù†Øª ÙˆØ§Ù„Ø¯ -->
						        <li class="reviews-list__item">
						        <div class="review">
						        	<div class="review__avatar">
                                        {% if comment.is_admin_comment  %}
						        		<img src="{{ media_url }}images/comments/admin.png" alt="admin-comment">
                                        {% else %}
                                        <img src="{{ media_url }}images/comments/user.png" alt="user-comment">
                                        {% endif %}
						        	</div>
						        	<div class="review__content">
						        		<div class="review__author">{{ comment.commenting_user.name }}</div>
						        		<div class="review__text">{{ comment.comment_text }}</div>
						        		<div class="review__date">{{ comment.registerdate }}</div>
						        	</div>
						        </div>

                                
                                {% if user.is_authenticated and comment.commenting_user != user %}
							        <div>
                                    
							        	<a  class="bg-amber-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-amber-700 transition duration-300" id="btn_{{ comment.id }}" 
                                        onclick="showCreateCommentForm({{ specific_service_clicked.id }}, {{ comment.id }}, {{ comment.commenting_user.id }}, '{{       specific_service_clicked.slug }}');">Ù¾Ø§Ø³Ø®</a>

							        </div>
							
							<div id="comment_form_{{ comment.id }}">
								
							</div>
						{% endif %}
						
						<!-- Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ -->
						{% for reply in comment.comment_child.all %}
							{% if reply.is_active %}
								<li class="reviews-list__item" style="background-color: beige; width: 95%; margin: 10px 5%;">
									<div class="review">
										<div class="review__avatar">
										    {% if  reply.is_admin_comment %}
						        		    <img src="{{ media_url }}images/comments/admin.png" alt="admin-comment">
                                            {% else %}
                                            <img src="{{ media_url }}images/comments/user.png" alt="user-comment">
                                            {% endif %}
										</div>
										<div class="review__content">
											<div class="review__author">{{ reply.commenting_user.name }}</div>
											<div class="review__text">{{ reply.comment_text }}</div>
											<div class="review__date">{{ reply.registerdate }}</div>
										</div>
									</div>
								</li>
							{% endif %}
						{% endfor %}
							
						</li>
						{% endif %}
						{% endfor %}
						</div>
						</div>
					</div>

                            {% if user.is_authenticated %}
				        		<h3 class="reviews-view__header">Ø¯ÛŒØ¯Ú¯Ø§Ù‡ Ùˆ Ø³ÙˆØ§Ù„Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø±Ø¨Ø§Ø±Ù‡ ÛŒ {{specific_service_clicked.service_title}} Ø¯Ø± <span style="color:#38cf38;">Ú©Ù„ÛŒÙ†ÛŒÚ© Ø±ÙˆÛŒØ§Ù„</span> Ø¨Ø§ Ù…Ø§ Ø¯Ø± Ù…ÛŒØ§Ù† Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ </h3>

				        						<div class="row">
				        							<div class="col-12 col-lg-9 col-xl-8">
				        								{% render_partial "csf:create_comment" slug=specific_service_clicked.slug %}
				        								</div>
				        							</div>
				        						</div>
				        	{% else %}
                                            
				        		<h5> 
				        			Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ø¬ Ø¯ÛŒØ¯Ú¯Ø§Ù‡ Ø®ÙˆØ¯ Ø¨Ø§ÛŒØ¯ 
				        			<a style="color:#38cf38;" href="{% url "account:login" %}?next={% url 'services:service_detail' specific_service_clicked.slug %}">ÙˆØ±ÙˆØ¯</a> 
				        			ÛŒØ§ 
				        			<a style="color:#38cf38;" href="{% url "account:register" %}?next={% url 'services:service_detail' specific_service_clicked.slug %}">Ø«Ø¨Øª Ù†Ø§Ù…</a>
                                
				        			Ú©Ù†ÛŒØ¯
				        		</h5>
                            
				        	{% endif %}

                        </div>
                    </div>  

{% comment %} -------------------------------------------------------------------------------------------------------------------------- {% endcomment %}
<hr>
{% comment %} -------------------------------------------------------------------------------------------------------------------------- {% endcomment %}

{% comment %} <style>
/* Add this style to disable pointer events for stars after voting */
.fa-star.disable {
    pointer-events: none;
    opacity: 0.5;
}
/* Style for checked (selected) stars */
.fa-star.checked {
    color: #ffc107 !important;
}
/* Optional: style for unselected stars */
.fa-star {
    color: #ccc;
    transition: color 0.2s;
}

</style>

<div style="display: flex; justify-content: space-between; align-items: center;">
    <h6>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² Ø³Ø±ÙˆÛŒØ³ : <span style="color: red;" id="avg_score">{{specific_service_clicked.get_average_score}}</span></h6>
        
    {% if user.is_authenticated %}
        {% if specific_service_clicked.get_user_score > 0 %}
            <div>
                {% with ''|center:5 as range %}
                    {% for i in range %}
                        {% if forloop.counter <= specific_service_clicked.get_user_score %}
                            <span id="star_{{forloop.counter}}" class="fa fa-star checked"></span>
                        {% else %}
                            <span id="star_{{forloop.counter}}" class="fa fa-star"></span>
                        {% endif %}
                    {% endfor %}
                {% endwith %}
            </div>
        {% else %}
            <div id="star-rating-group" data-service-id="{{ specific_service_clicked.id }}">
                <span id="star_1" class="fa fa-star cursor-pointer" onclick="addScore(1)"></span>
                <span id="star_2" class="fa fa-star cursor-pointer" onclick="addScore(2)"></span>
                <span id="star_3" class="fa fa-star cursor-pointer" onclick="addScore(3)"></span>
                <span id="star_4" class="fa fa-star cursor-pointer" onclick="addScore(4)"></span>
                <span id="star_5" class="fa fa-star cursor-pointer" onclick="addScore(5)"></span>
            </div>
            <div style="margin-top: 10px;">
                <textarea id="idea_text" rows="2" placeholder="Ø§ÛŒØ¯Ù‡ ÛŒØ§ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." style="width: 250px; resize: vertical;"></textarea>
            </div>
            <button type="button" id="submit_idea_btn" class="bg-amber-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-amber-700 transition duration-300" style="margin-top: 8px;" onclick="submitIdea()">Ø«Ø¨Øª Ø§ÛŒØ¯Ù‡</button>
        {% endif %}
    
{% else %}
    <h6 style="text-decoration: underline;">
        Ø¨Ø±Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ø¯Ù‡ÛŒ
        <a href="{% url "account:login" %}?next={% url 'services:service_detail' specific_service_clicked.slug %}">ÙˆØ±ÙˆØ¯</a> 
        ÛŒØ§ 							
        <a href="{% url "account:register" %}?next={% url 'services:service_detail' specific_service_clicked.slug %}">Ø«Ø¨Øª Ù†Ø§Ù…</a>
        Ú©Ù†ÛŒØ¯
    </h6>
{% endif %}
</div>

<script>
    
let selectedScore = 0;

function addScore(score) {
    selectedScore = score;
    // Only target interactive stars
    var starRatings = document.querySelectorAll("#star-rating-group .fa-star");

    // Reset all stars
    starRatings.forEach(element => {
        element.classList.remove("checked");
    });

    // Highlight selected stars
    for (let i = 1; i <= score; i++) {
        const element = document.getElementById("star_" + i);
        if (element) {
            element.classList.add("checked");
        }
    }
}

// Submit both score and idea
function submitIdea() {
    var idea = document.getElementById("idea_text").value;
    var starGroup = document.getElementById("star-rating-group");
    var serviceId = starGroup ? starGroup.getAttribute("data-service-id") : null;

    if (!serviceId) {
        alert("Ø®Ø·Ø§: Ø´Ù†Ø§Ø³Ù‡ Ø³Ø±ÙˆÛŒØ³ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
        return;
    }
    if (selectedScore === 0) {
        alert("Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ Ø§Ù…ØªÛŒØ§Ø² Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");
        return;
    }

    $.ajax({
        type: "POST",
        url: "{% url 'csf:add_score' %}",
        data: {
            service_id: serviceId,
            score: selectedScore,
            idea: idea,
            csrfmiddlewaretoken: getCookie('csrftoken')
        },
        success: function(res) {
            if (res.status === "success") {
                addScore(res.user_score);
                alert(res.message);
                $("#avg_score").text(res.avg_score);
                $("#star-rating-group .fa-star").addClass("disable");
                $("#idea_text").prop("disabled", true);
                $("#submit_idea_btn").prop("disabled", true);
            } else {
                alert(res.message);
            }
        },
        error: function(xhr) {
            try {
                const res = JSON.parse(xhr.responseText);
                alert(res.message);
            } catch (e) {
                alert("Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯.");
            }
        }
    });
}

// Function to get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script> {% endcomment %}

{% comment %} -------------------------------------------------------------------------------------------------------------------------- {% endcomment %}

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'gold': '#ffc107',
                    }
                }
            }
        }
    </script>
    <style>

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        @keyframes starPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .star-pop {
            animation: starPop 0.5s ease-in-out;
        }
        
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center py-8">
    <div class="container max-w-4xl mx-auto px-4">
        <!-- Service Card -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
            <div class="md:flex">
                <div class="md:w-2/5 p-6 bg-gradient-to-br from-amber-500 to-amber-700 flex items-center justify-center">
                    <div class="text-center text-white">
                        <i class="fas fa-cloud-service text-7xl mb-4"></i>
                        <h1 class="text-2xl font-bold">Ø³Ø±ÙˆÛŒØ³ Ø§Ø¨Ø±ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>
                        <p class="mt-2 opacity-90">ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ Ø§Ù…Ù† Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ§Ø±ØªØ§Ù¾â€ŒÙ‡Ø§</p>
                    </div>
                </div>
                <div class="md:w-3/5 p-6">
                    <div class="flex flex-col gap-2 mb-6">
                        <div class="flex items-center">
                            <i class="fas fa-database text-amber-600 text-xl ml-2"></i>
                            <span>100 Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª ÙØ¶Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-user-shield text-amber-600 text-xl ml-2"></i>
                            <span>Ø§Ù…Ù†ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ SSL</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-sync-alt text-amber-600 text-xl ml-2"></i>
                            <span>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ 24/7</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-plug text-amber-600 text-xl ml-2"></i>
                            <span>ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§</span>
                        </div>
                    </div>
                    <div class="border-t pt-4">
                        <p class="text-gray-600">
                            Ø³Ø±ÙˆÛŒØ³ Ø§Ø¨Ø±ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±â€ŒÙ‡Ø§ÛŒ Ù†ÙˆÙ¾Ø§ Ùˆ Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯. Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ù…Ù† Ùˆ Ø³Ø±ÛŒØ¹ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒØªØ§Ù† Ø§Ø² Ù‡Ø± Ú©Ø¬Ø§ÛŒ Ø¯Ù†ÛŒØ§.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Rating Component -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-4 mb-6">Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³</h2>
            
            <!-- Rating Stats -->
            <div id="rating-component" class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                <div id="average-section" class="flex items-center mb-4 md:mb-0">
                    <div class="bg-amber-100 text-amber-800 w-14 h-14 rounded-full flex items-center justify-center ml-3">
                        <i class="fas fa-star"></i>
                    </div>
                    <div>
                        <p class="text-gray-600">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² Ø³Ø±ÙˆÛŒØ³:</p>
                        <div class="flex items-baseline">
                            <span id="avg_score" class="text-2xl font-bold text-amber-600">4.3</span>
                            <span class="text-gray-500 text-sm mr-1">Ø§Ø² 5</span>
                        </div>
                    </div>
                </div>
                
                <!-- Rating Controls -->
                <div id="user-rating-section" class="flex-1 w-full md:w-auto">
                    <!-- User Rating Controls will be rendered here by JavaScript -->
                </div>
            </div>
            
            <!-- Rating Chart -->
            <div class="hidden md:block mt-10 mb-8">
                <h3 class="text-lg font-medium mb-4 text-gray-700">ØªÙˆØ²ÛŒØ¹ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</h3>
                <div class="space-y-3">
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 5</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-3/4"></div>
                        </div>
                        <span class="w-8 text-right">75%</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 4</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-1/2"></div>
                        </div>
                        <span class="w-8 text-right">50%</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 3</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-1/3"></div>
                        </div>
                        <span class="w-8 text-right">33%</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 2</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-1/5"></div>
                        </div>
                        <span class="w-8 text-right">20%</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-8 text-amber-600"><i class="fas fa-star"></i> 1</span>
                        <div class="flex-1 h-3 bg-gray-200 rounded-full mx-3">
                            <div class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full w-1/10"></div>
                        </div>
                        <span class="w-8 text-right">10%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notification Container -->
        <div id="notification" class="fixed top-5 left-1/2 transform -translate-x-1/2 w-full max-w-md px-4 z-50"></div>
    </div>
    
    <script>
        // Initialize service data
        const serviceId = 1;
        let selectedScore = 0;
        let userHasRated = false;
        
        // Initialize the rating component
        function initRatingComponent() {
            const ratingSection = document.getElementById('user-rating-section');
            const avgScoreSpan = document.getElementById('avg_score');
            
            // Check if user has rated this service in localStorage
            const storedRating = localStorage.getItem(`service_rating_${serviceId}`);
            if (storedRating) {
                const {score, rated} = JSON.parse(storedRating);
                if (rated) {
                    userHasRated = true;
                    selectedScore = score;
                    renderRatedState(score);
                    avgScoreSpan.textContent = (parseFloat(avgScoreSpan.textContent) + 0.2).toFixed(1);
                    return;
                }
            }
            
            // Render the rating UI for an unrated user
            renderInteractiveRating();
        }
        
        // Render the interactive rating UI
        function renderInteractiveRating() {
            const ratingSection = document.getElementById('user-rating-section');
            ratingSection.innerHTML = `
                <div class="bg-gray-50 rounded-xl p-5 shadow-sm">
                    <div id="star-rating-group" data-service-id="${serviceId}" class="flex justify-center my-4">
                        ${Array(5).fill().map((_, i) => 
                            `<span id="star_${5-i}" class="fa fa-star text-3xl mx-1 cursor-pointer text-gray-300 hover:text-amber-400 transition-colors duration-300" data-score="${5-i}" onclick="handleStarClick(${5-i})"></span>`
                        ).join('')}
                    </div>
                    
                    <div class="mt-5">
                        <label for="idea_text" class="block text-sm font-medium text-gray-700 mb-2">Ø§ÛŒØ¯Ù‡ ÛŒØ§ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ù…Ø§ Ø¯Ø± Ù…ÛŒØ§Ù† Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯</label>
                        <textarea id="idea_text" rows="3" placeholder="Ù†Ø¸Ø± Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø³Ø±ÙˆÛŒØ³ Ù…Ø§ Ø¨Ø³ÛŒØ§Ø± Ø§Ø±Ø²Ø´Ù…Ù†Ø¯ Ø§Ø³Øª..." class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-amber-300 focus:border-amber-400 transition"></textarea>
                    </div>
                    
                    <button id="submit_idea_btn" class="mt-4 w-full py-3 bg-gradient-to-r from-amber-500 to-amber-700 text-white font-bold rounded-lg shadow-md hover:from-amber-600 hover:to-amber-800 transition-all duration-300 transform hover:scale-[1.02]" onclick="submitIdea()">
                        Ø«Ø¨Øª Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ù†Ø¸Ø±
                    </button>
                </div>
            `;
        }
        
        // Render UI for already rated users
        function renderRatedState(score) {
            const ratingSection = document.getElementById('user-rating-section');
            ratingSection.innerHTML = `
                <div class="bg-amber-50 rounded-xl p-5 border border-amber-200">
                    <div class="flex flex-col items-center">
                        <div class="flex my-2">
                            ${Array(5).fill().map((_, i) => 
                                `<span class="fa fa-star text-3xl mx-1 ${i < score ? 'text-amber-500' : 'text-gray-300'}"></span>`
                            ).join('')}
                        </div>
                        <div class="mt-2 bg-amber-100 text-amber-800 px-4 py-2 rounded-full text-sm">
                            <i class="fas fa-check-circle ml-1"></i>
                            Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: ${score} Ø³ØªØ§Ø±Ù‡
                        </div>
                        <p class="text-sm text-gray-600 mt-3 text-center">
                            Ø§Ø² Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ùˆ Ù†Ø¸Ø± Ø´Ù…Ø§ Ø³Ù¾Ø§Ø³Ú¯Ø²Ø§Ø±ÛŒÙ….
                        </p>
                    </div>
                </div>
            `;
        }
        
        // Handle star selection
        function handleStarClick(score) {
            if (userHasRated) return;
            
            selectedScore = score;
            const stars = document.querySelectorAll('#star-rating-group .fa-star');
            
            // Update star appearance
            stars.forEach(star => {
                const starScore = parseInt(star.getAttribute('data-score'));
                if (starScore <= score) {
                    star.classList.add('text-amber-500', 'star-pop');
                    star.classList.remove('text-gray-300');
                } else {
                    star.classList.add('text-gray-300');
                    star.classList.remove('text-amber-500');
                }
            });
        }
        
        // Submit rating and idea
        function submitIdea() {
            const ideaText = document.getElementById('idea_text').value;
            
            if (!selectedScore) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø§Ù…ØªÛŒØ§Ø² Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            // Save to localStorage
            localStorage.setItem(`service_rating_${serviceId}`, JSON.stringify({
                serviceId: serviceId,
                score: selectedScore,
                idea: ideaText,
                rated: true,
                timestamp: new Date().toISOString()
            }));
            
            userHasRated = true;
            renderRatedState(selectedScore);
            updateAverageScore();
            showNotification('Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯. Ø§Ø² Ù†Ø¸Ø± Ø´Ù…Ø§ Ø³Ù¾Ø§Ø³Ú¯Ø²Ø§Ø±ÛŒÙ…!', 'success');
        }
        
        // Update average score visually
        function updateAverageScore() {
            const avgScoreSpan = document.getElementById('avg_score');
            let currentScore = parseFloat(avgScoreSpan.textContent);
            avgScoreSpan.textContent = (currentScore + 0.1).toFixed(1);
        }
        
        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-rose-500';
            
            notification.innerHTML = `
                <div class="flex items-center ${bgColor} text-white text-sm font-bold px-4 py-3 rounded-md shadow-lg transform transition-transform duration-300 translate-y-0" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} mr-2 text-xl"></i>
                    <div>
                        <p class="font-bold">${type === 'success' ? 'Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²' : 'Ø®Ø·Ø§'}</p>
                        <p>${message}</p>
                    </div>
                </div>
            `;
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                notification.innerHTML = '';
            }, 3000);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initRatingComponent);
    </script>
{% comment %} -------------------------------------------------------------------------------------------------------------------------- {% endcomment %}

    <!-- Related Services -->
    <section class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Ø®Ø¯Ù…Ø§Øª Ù…Ø±ØªØ¨Ø·</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">Ø³Ø§ÛŒØ± Ø®Ø¯Ù…Ø§Øª Ø²ÛŒØ¨Ø§ÛŒÛŒ Ú©Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø¬Ø°Ø§Ø¨ Ø¨Ø§Ø´Ø¯</p>
                <div class="w-20 h-1 bg-amber-500 mx-auto mt-4"></div>
            </div>
            
            <div class="grid md:grid-cols-3 gap-8">

                {% render_partial "services:service_related" slug=specific_service_clicked.slug %}

                
            </div>
        </div>

    </section>


    

    <!-- Appointment CTA -->
    <section id="appointment" class="py-16 bg-gradient-to-r from-amber-100 to-amber-200">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6">Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø±ÙˆØ¹ Ø³ÙØ± Ø²ÛŒØ¨Ø§ÛŒÛŒ Ø®ÙˆØ¯ Ù‡Ø³ØªÛŒØ¯ØŸ</h2>
                <p class="text-xl text-gray-700 mb-8">Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§ÙˆØ±Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù† Ùˆ Ø±Ø²Ø±Ùˆ Ù†ÙˆØ¨Øª Ø¨Ø§ Ù…Ø§ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯ ÛŒØ§ ÙØ±Ù… Ø±Ø²Ø±Ùˆ Ù†ÙˆØ¨Øª Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯</p>
                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 sm:space-x-reverse">
                    <a href="tel:+982112345678" class="bg-amber-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-amber-700 transition duration-300 inline-flex items-center justify-center">
                        <i class="fas fa-phone ml-2"></i>
                        <span>ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</span>
                    </a>
                    <a href="#appointment-form" class="bg-white text-amber-700 px-8 py-3 rounded-lg font-bold hover:bg-gray-100 transition duration-300 inline-flex items-center justify-center">
                        <i class="fas fa-calendar-alt ml-2"></i>
                        <span>Ø±Ø²Ø±Ùˆ Ù†ÙˆØ¨Øª Ø¢Ù†Ù„Ø§ÛŒÙ†</span>
                    </a>
                </div>
            </div>
        </div>
    </section>



    {% block extra_js %}
    <script src="{% static "js/service_details.js" %}"></script>
    {% endblock extra_js %}
    
{% endblock content %}